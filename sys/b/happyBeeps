#!/usr/bin/env python3
from __future__ import annotations

import math
import subprocess
import time

SAMPLE_RATE = 44100
DURATION = 0.15  # seconds per beep
VOLUME = 0.45
FREQS = (784.0, 988.0, 1318.5)  # ascending sparkle
PAUSE_SECONDS = 0.5
REPEAT = 1


def generate_tone(freq: float, duration: float) -> bytes:
    total_samples = int(SAMPLE_RATE * duration)
    max_amplitude = int(32767 * VOLUME)
    buffer = bytearray()
    for n in range(total_samples):
        value = int(max_amplitude * math.sin(2 * math.pi * freq * (n / SAMPLE_RATE)))
        buffer += value.to_bytes(2, byteorder="little", signed=True)
    return bytes(buffer)


def play_raw_pcm(pcm_bytes: bytes) -> None:
    subprocess.run(
        [
            "aplay",
            "-q",
            "-f",
            "S16_LE",
            "-r",
            str(SAMPLE_RATE),
        ],
        input=pcm_bytes,
        check=False,
    )


def main() -> None:
    tones = [generate_tone(freq, DURATION) for freq in FREQS]
    for _ in range(REPEAT):
        for tone in tones:
            play_raw_pcm(tone)
            time.sleep(PAUSE_SECONDS / 2)
#        for tone in reversed(tones[:-1]):
#            play_raw_pcm(tone)
#            time.sleep(PAUSE_SECONDS)


if __name__ == "__main__":
    main()
